<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Playlists de Gallumbo Verde</title>
  <style>
   body {
  font-family: 'Segoe UI', sans-serif;
  background-color: #0f0f0f;
  color: #fff;
  margin: 0;
  padding: 2rem;
}

h1 {
  text-align: center;
  font-size: 1.2rem;
  margin-bottom: 1rem;
  color: #fff;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
  margin-bottom: 2rem;
}

.controls input,
.controls select {
  padding: 0.4rem 0.6rem;
  border-radius: 4px;
  border: none;
  font-size: 0.9rem;
  background-color: #333;
  color: #fff;
  flex: 1 1 150px;
  max-width: 200px;
}

.controls input::placeholder {
  color: #ccc;
}

.galeria {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 1rem;
  padding: 0 1rem;
}

.card {
  position: relative;
  border: 2px solid #fff;
  border-radius: 6px;
  overflow: hidden;
  text-decoration: none;
  color: inherit;
  display: block;
  aspect-ratio: 16 / 9;
  background-color: #000;
  opacity: 0;
  transform: scale(0.95);
  animation: fadeIn 0.3s ease forwards;
}

@keyframes fadeIn {
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.card h2 {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  margin: 0;
  padding: 0.5rem;
  font-size: 0.85rem;
  background-color: rgba(0, 0, 0, 0.6);
  color: #fff;
  text-align: center;
}

#loading::after {
  content: '';
  animation: dots 1.5s steps(3, end) infinite;
}

@keyframes dots {
  0% { content: ''; }
  33% { content: '.'; }
  66% { content: '..'; }
  100% { content: '...'; }
}

    .card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform 0.3s ease;
}

.card:hover img {
  transform: scale(1.05);
}

    
  </style>
</head>
<body>
 

  <h1>Playlists de Gallumbo Verde</h1>

  <div class="controls">
    <input type="text" id="buscador" placeholder="Buscar por nombre...">
    <select id="categorias"></select>
    <select id="orden">
      <option value="reciente">M√°s recientes</option>
      <option value="antiguo">M√°s antiguos</option>
      <option value="az">A-Z</option>
      <option value="za">Z-A</option>
    </select>
  </div>

 <div id="loading" style="text-align:center; font-size:1rem; margin-bottom:1rem;">
  Cargando playlists
</div>
  
  <div class="galeria" id="galeria"></div>

  <script>
    let datosOriginales = [];

    fetch("https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLiau3JY_ONq497ybNpoMBr3dkF6YjsMRdQkoKbDoPxyvFqSU3xV2uAxma2uwVq4DdOpa0iF_utMkoVIOkIPFk7CU7ZelUldhxtybazMtt6kpv1gQ20flyLTDt2MaZSr6BzBb5HK-m_Zqe90kEaOfH5xJDmq3WuEyXs7EN02QCaONE6HAndk55938tNKWEmIQwfVX3eMTkBONVDRR-1ozQCi38KYlnG1syDK7MItLQRqqcxOl6US_WyJsIrfNp4XQWlT255TUFltjY8Ym12tPacKjskNcA&lib=MCWe42NHbQqOrLIPOqVQuyM683hYefgmI")
      .then(res => res.json())
      .then(data => {
        datosOriginales = data;
        renderizarGaleria(data);
        cargarCategorias(data);
        document.getElementById("loading").style.display = "none";

      });

   function renderizarGaleria(data) {
  const contenedor = document.getElementById("galeria");
  contenedor.innerHTML = "";

  data.forEach(item => {
    const card = document.createElement("a");
    card.className = "card";
    card.href = item.enlace;
    card.target = "_blank";
    card.innerHTML = `
      <img src="${item.miniatura}" alt="${item.titulo}">
      <h2>${item.titulo}</h2>
    `;

    // üîß Forzar reflujo antes de aplicar animaci√≥n
    card.style.opacity = "0";
    card.style.transform = "scale(0.95)";
    contenedor.appendChild(card);
    requestAnimationFrame(() => {
      card.style.transition = "opacity 0.3s ease, transform 0.3s ease";
      card.style.opacity = "1";
      card.style.transform = "scale(1)";
    });
  });
}


    function cargarCategorias(data) {
      const select = document.getElementById("categorias");
      const conteo = {};
      data.forEach(item => {
        conteo[item.categoria] = (conteo[item.categoria] || 0) + 1;
      });

      const ordenadas = Object.entries(conteo)
        .sort((a, b) => b[1] - a[1]);

      select.innerHTML = `<option value="">Todas las categor√≠as</option>`;
      ordenadas.forEach(([cat, count]) => {
        select.innerHTML += `<option value="${cat}">${cat} (${count})</option>`;
      });
    }

    document.getElementById("buscador").addEventListener("input", filtrar);
    document.getElementById("categorias").addEventListener("change", filtrar);
    document.getElementById("orden").addEventListener("change", filtrar);
    

    function filtrar() {
      const texto = document.getElementById("buscador").value.toLowerCase();
      const categoria = document.getElementById("categorias").value;
      const orden = document.getElementById("orden").value;

      let filtrados = datosOriginales.filter(item =>
        item.titulo.toLowerCase().includes(texto) &&
        (categoria === "" || item.categoria === categoria)
      );

      if (orden === "reciente") {
        filtrados.sort((a, b) => new Date(b.fechaISO) - new Date(a.fechaISO));
      } else if (orden === "antiguo") {
        filtrados.sort((a, b) => new Date(a.fechaISO) - new Date(b.fechaISO));
      } else if (orden === "az") {
        filtrados.sort((a, b) => a.tituloorden.localeCompare(b.tituloorden));
      } else if (orden === "za") {
        filtrados.sort((a, b) => b.tituloorden.localeCompare(a.tituloorden));
      }

      renderizarGaleria(filtrados);
    }
  </script>
</body>
</html>

